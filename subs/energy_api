from datetime import datetime, timedelta
import requests
from pandas import DataFrame


# data is availble every 30 minutes, so we need to start at the nearest half-hour
def round_down_time(dt):
    # Round down to the nearest half-ho/ur
    new_minute = 30 if dt.minute >= 30 else 0
    return dt.replace(minute=new_minute, second=0, microsecond=0)


# Function to create the API URL based on the start and end datetimes and the region
def create_url(start_datetime, end_datetime, region):
    start_str = start_datetime.strftime("%Y%m%d%H%M")
    end_str = end_datetime.strftime("%Y%m%d%H%M")
    url = f"https://www.co2.smartgriddashboard.com/api/co2_fc/{start_str}/{end_str}/{region}"
    return url


# Current date and time
now = datetime.now()
# Round down to the nearest half-hour
start_time = round_down_time(now)
# For end time, let's use 24 hours from now
end_time = now.replace(
    hour=23, minute=59, second=59, microsecond=0
)  # now + timedelta(days=1)

# Define the region
region = ["ROI", "NI", "ALL"]

# Create the URL
api_url = create_url(start_time, end_time, region[2])
response = requests.get(api_url)
Rs = response.json()
